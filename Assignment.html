<!DOCTYPE html>
<html>
    <head>
        <Title>Daily Quotes</Title>
        <script>
            function noenter() {
              return !(window.event && window.event.keyCode == 13); }
            </script>
    </head>
    <body onload="menus()">

        <h2>Task 1</h2>
        <h3>Possible categories:</h3>
        <h4>"inspire", "management", "sports", "life", "funny", "love", "art", "students"</h4>
        <form class="well" name="formInput" >
            <label>Category:</label>
            <input Id="txtvarInput" type="text" placeholder="inspire" onkeypress="return noenter()"/>
                <script>
                    var text = document.getElementById('txtvarInput');
                </script>
        </form>
        
        <h4>Press to submit your choice and see the quote of the day:</h4>
        <input type="submit" value="Submit choice" onclick="submit()">
        <p id="quote1">"..."</p>
        <p id="author1"></p>


        <script>
            var doc;
            var debug;

            function menus(){
                menuSetup();
                menuSetup2();
            }          

            function submit() {
                var xhr = new XMLHttpRequest();
                var str = text.value; 
                var cat = str.toLowerCase();
                if( cat == "inspire" || cat == "management" || cat == "sports" || cat == "life" || cat == "funny" || cat == "love" || cat == "art" || cat == "students" ){
                    xhr.onreadystatechange = function () {
                        debug = xhr;
                        if (xhr.status === 429 ){
                            document.getElementById("quote1").innerHTML = "Error 429: Too many requests. Please wait an hour before retrying";
                        } else if (xhr.readyState === 4) {
                            doc = xhr.responseXML;
                            document.getElementById("quote1").innerHTML ='"' + doc.getElementsByTagName("quote")[0].childNodes[0].nodeValue + '"';
                            document.getElementById("author1").innerHTML = doc.getElementsByTagName("author")[0].childNodes[0].nodeValue;
                        }
                    }
                    xhr.open('get', 'http://quotes.rest/qod?category='+cat, true);
                    xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                    xhr.send();
                } else {
                    document.getElementById("quote1").innerHTML = "Error: invalid category.";
                    document.getElementById("author1").innerHTML = "";
                }
            }

        </script>

        <hr/>

        <h2>Task 2</h2>

        <form>
            <label>Categories:</label>
            <select name="categories" id="c">
            </select>
            <script>
            var cat2 = document.getElementById("c");
            </script>
        </form>

        <input type="submit" value="Submit choice" onclick="submit2()">

        <p id="quote2">"..."</p>
        <p id="author2"></p>

        <script>
            var catpage;

            function menuCreation( dropDown, index ){
                var menu = document.getElementById( dropDown );
                var df = document.createDocumentFragment();
                for (var i = 1; i <= index; i++ ){
                    var option = document.createElement('option');
                    option.value = "";
                    option.id = dropDown + i;
                    option.appendChild(document.createTextNode("option #" + i));
                    df.appendChild(option);
                }
                menu.appendChild(df);
            }

            function submit2() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote2").innerHTML = "Error 429: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        doc = xhr.responseXML;
                        document.getElementById("quote2").innerHTML = '"' + doc.getElementsByTagName("quote")[0].childNodes[0].nodeValue + '"';
                        document.getElementById("author2").innerHTML = doc.getElementsByTagName("author")[0].childNodes[0].nodeValue;
                    }
                }
                xhr.open('get', 'http://quotes.rest/qod?category='+cat2.value, true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }
            
            function menuSetup() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote3").innerHTML = "Error 429: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        catpage = xhr.responseXML;
                        var n = catpage.getElementsByTagName("total")[0].childNodes[0].nodeValue;
                        var x = catpage.getElementsByTagName("categories")[0];
                        menuCreation( "c", n );
                        for(var i = 1; i <= n; i++){
                            document.getElementById("c" + i).innerHTML = x.childNodes[ 2*i-1 ].textContent;
                            document.getElementById("c" + i).setAttribute("value", x.childNodes[ 2*i-1 ].tagName);
                        }
                    }
                }
                xhr.open('get', 'https://quotes.rest/qod/categories', true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }

        </script>

        <hr/>

        <h2>Task 3</h2>

        <form>
            <label>Categories:</label>
            <select name="categories" id="b" onchange="submit3()">
            </select>
            <script>
            var cat3 = document.getElementById("b");
            </script>
        </form>

        <p id="quote3">"..."</p>
        <p id="author3"></p>

        <script>

            function menuSetup2() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote3").innerHTML = "Error: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        catpage = xhr.responseXML;
                        var n = catpage.getElementsByTagName("total")[0].childNodes[0].nodeValue;
                        var x = catpage.getElementsByTagName("categories")[0];
                        menuCreation( "b", n );
                        for(var i = 1; i <= n; i++){
                            document.getElementById("b" + i).innerHTML = x.childNodes[ 2*i-1 ].textContent;
                            document.getElementById("b" + i).setAttribute("value", x.childNodes[ 2*i-1 ].tagName);
                        }
                    }
                }
                xhr.open('get', 'https://quotes.rest/qod/categories', true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }

            function submit3() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote3").innerHTML = "Error: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        doc = xhr.responseXML;
                        document.getElementById("quote3").innerHTML = '"' + doc.getElementsByTagName("quote")[0].childNodes[0].nodeValue + '"';
                        document.getElementById("author3").innerHTML = doc.getElementsByTagName("author")[0].childNodes[0].nodeValue;
                    }
                }
                xhr.open('get', 'http://quotes.rest/qod?category='+cat3.value, true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }

        </script>


        

    </body>
</html>