<!DOCTYPE html>
<html>
    <head>
        <Title>Daily Quotes</Title>
    </head>
    <body onload="menus()">

        <h2>Task 1</h2>
        <h3>Possible categories:</h3>
        <h4>Inspire, Management, Sports, Life, Funny, Love, Art, Students</h4>
        <form class="well" name="formInput" >
            <label>Category:</label>
            <input Id="txtvarInput" type="text" placeholder="Inspire" />
                <script>
                    var cat = document.getElementById('txtvarInput');
                </script>
        </form>
        
        <h4>Press to submit your choice and see the quote of the day:</h4>
        <input type="submit" value="Submit choice" onclick="submit()">
        <p id="quote1">"..."</p>
        <p id="author1"></p>


        <script>
            var doc;  

            function menus(){
                menuSetup();
                menuSetup2();
            }          

            function submit() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429 ){
                        document.getElementById("quote1").innerHTML = "Error: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        doc = xhr.responseXML;
                        document.getElementById("quote1").innerHTML ='"' + doc.getElementsByTagName("quote")[0].childNodes[0].nodeValue + '"';
                        document.getElementById("author1").innerHTML = doc.getElementsByTagName("author")[0].childNodes[0].nodeValue;
                    }
                }
                xhr.open('get', 'http://quotes.rest/qod?category='+cat.value, true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }

            function display(){ //funzione usata durante lo sviluppo ma assente nella versione finale.
                var x = doc.getElementsByTagName("quote")[0].childNodes[0].nodeValue;
                console.log( x );
                var y = doc.getElementsByTagName("author")[0].childNodes[0].nodeValue;
                console.log( y );
            }

        </script>

        <hr/>

        <h2>Task 2</h2>

        <form>
            <label>Categories:</label>
            <select name="categories" id="cat">
                <option value="" id="c1">-</option>
                <option value="" id="c2">-</option>
                <option value="" id="c3">-</option>
                <option value="" id="c4">-</option>
                <option value="" id="c5">-</option>
                <option value="" id="c6">-</option>
                <option value="" id="c7">-</option>
                <option value="" id="c8">-</option>
            </select>
            <script>
            var cat2 = document.getElementById("cat");
            </script>
        </form>

        <input type="submit" value="Submit choice" onclick="submit2()">

        <p id="quote2">"..."</p>
        <p id="author2"></p>

        <script>
            var catpage;

            function submit2() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote2").innerHTML = "Error: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        doc = xhr.responseXML;
                        document.getElementById("quote2").innerHTML = '"' + doc.getElementsByTagName("quote")[0].childNodes[0].nodeValue + '"';
                        document.getElementById("author2").innerHTML = doc.getElementsByTagName("author")[0].childNodes[0].nodeValue;
                        //display();
                    }
                }
                xhr.open('get', 'http://quotes.rest/qod?category='+cat2.value, true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }
            
            function menuSetup() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote3").innerHTML = "Error: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        catpage = xhr.responseXML;      // error 429 = too many requests.
                        var x = catpage.getElementsByTagName("categories")[0];
                        for(var i = 1; i < 9; i++){
                            document.getElementById("c" + i).innerHTML = x.childNodes[ 2*i-1 ].textContent;
                            document.getElementById("c" + i).setAttribute("value", x.childNodes[ 2*i-1 ].tagName);
                        }
                    }
                }
                xhr.open('get', 'https://quotes.rest/qod/categories', true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }

        </script>

        <hr/>

        <h2>Task 3</h2>

        <form>
            <label>Categories:</label>
            <select name="categories" id="cat2" onchange="submit3()">
                <option value="" id="b1">-</option>
                <option value="" id="b2">-</option>
                <option value="" id="b3">-</option>
                <option value="" id="b4">-</option>
                <option value="" id="b5">-</option>
                <option value="" id="b6">-</option>
                <option value="" id="b7">-</option>
                <option value="" id="b8">-</option>
            </select>
            <script>
            var cat3 = document.getElementById("cat2");
            </script>
        </form>

        <p id="quote3">"..."</p>
        <p id="author3"></p>

        <script>

            function menuSetup2() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote3").innerHTML = "Error: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        catpage = xhr.responseXML;      // error 429 = too many requests.
                        var x = catpage.getElementsByTagName("categories")[0];
                        for(var i = 1; i < 9; i++){
                            document.getElementById("b" + i).innerHTML = x.childNodes[ 2*i-1 ].textContent;
                            document.getElementById("b" + i).setAttribute("value", x.childNodes[ 2*i-1 ].tagName);
                        }
                    }
                }
                xhr.open('get', 'https://quotes.rest/qod/categories', true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }

            function submit3() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.status === 429){
                        document.getElementById("quote3").innerHTML = "Error: too many requests. Please wait an hour before retrying";
                    } else if (xhr.readyState === 4) {
                        doc = xhr.responseXML;      // error 429 = too many requests.
                        document.getElementById("quote3").innerHTML = '"' + doc.getElementsByTagName("quote")[0].childNodes[0].nodeValue + '"';
                        document.getElementById("author3").innerHTML = doc.getElementsByTagName("author")[0].childNodes[0].nodeValue;
                        //display();
                    }
                }
                xhr.open('get', 'http://quotes.rest/qod?category='+cat3.value, true);
                xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml");
                xhr.send();
            }

        </script>


        

    </body>
</html>